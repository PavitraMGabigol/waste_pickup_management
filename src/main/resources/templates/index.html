<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Smart Waste Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(120deg, #a1c4fd, #c2e9fb);
            min-height: 100vh;
            position: relative;
            z-index: 1;
            overflow-x: hidden;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('/img/img.jpg') no-repeat center center/cover;
            z-index: -1;
        }

        nav {
            background-color: rgba(30, 60, 114, 0.9);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease-in-out;
        }

        nav h1 {
            font-size: 24px;
        }

        nav ul {
            list-style: none;
            display: flex;
        }

        nav ul li {
            margin-left: 20px;
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        nav ul li a:hover {
            text-decoration: underline;
            color: #ffd700;
        }

        .main-content {
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.85);
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            margin-top: 30px;
            transition: transform 0.3s ease;
            animation: fadeIn 1s ease forwards;
        }

        .container:hover {
            transform: scale(1.03);
        }

        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        label {
            font-weight: 600;
            margin-top: 15px;
            display: block;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 12px 14px;
            margin-top: 6px;
            margin-bottom: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 15px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            border-color: #1e3c72;
            outline: none;
        }

        button {
            background-color: #1e3c72;
            color: white;
            font-weight: bold;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #15305c;
            transform: scale(1.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #1e3c72;
            color: white;
        }

        .info-section {
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }

        .heading {
            font-size: 36px;
            font-weight: bold;
            color: #2c3e50;
            animation: fadeInText 2s ease-out;
        }

        @keyframes fadeInText {
            0% {
                opacity: 0;
                transform: translateY(-30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .footer {
            background-color: rgba(30, 60, 114, 0.9);
            color: white;
            padding: 20px;
            text-align: center;
            margin-top: 50px;
            z-index: 1;
        }

        a {
            transition: all 0.3s ease;
        }

        a:hover {
            color: #ffcc00;
        }

        /* Authentication Styles */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .auth-container {
            background-color: white;
            padding: 40px;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
            animation: fadeIn 0.6s ease forwards;
            position: relative;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .auth-header h2 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .auth-tab {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .auth-tab button {
            flex: 1;
            background: none;
            color: #666;
            padding: 12px;
            border: none;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .auth-tab button.active {
            color: #1e3c72;
            border-bottom: 3px solid #1e3c72;
        }

        .auth-tab button:hover {
            background-color: #f5f5f5;
            transform: none;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-footer {
            text-align: center;
            margin-top: 20px;
            color: #666;
        }

        .auth-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            width: auto;
            padding: 5px;
        }

        .auth-close:hover {
            color: #1e3c72;
            transform: scale(1.1);
        }

        .auth-btn {
            width: 100%;
            margin-top: 20px;
        }

        #dashboard-content {
            display: none;
        }

        #logout-btn {
            margin-left: 10px;
            padding: 8px 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
<!-- Authentication Overlay -->
<!-- Authentication Overlay -->
<div id="auth-overlay" class="auth-overlay">
    <div class="auth-container">
        <button id="auth-close" class="auth-close">√ó</button>
        <div class="auth-header">
            <h2>Smart Waste Management</h2>
            <p>Join our community for efficient waste management</p>
        </div>
        
        <div class="auth-tab">
            <button id="login-tab" class="active">Login</button>
            <button id="signup-tab">Sign Up</button>
        </div>
        
        <div id="login-form" class="auth-form active">
            <form id="login">
                <div class="form-group">
                    <label for="login-email">Email Address</label>
                    <input type="email" id="login-email" required>
                </div>
                
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" required>
                </div>
                
                <button type="submit" class="auth-btn">Login</button>
            </form>
        </div>
        
        <div id="signup-form" class="auth-form">
            <form id="signup">
                <div class="form-group">
                    <label for="signup-name">Full Name</label>
                    <input type="text" id="signup-name" required>
                </div>
                
                <div class="form-group">
                    <label for="signup-email">Email Address</label>
                    <input type="email" id="signup-email" required>
                </div>
                
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" minlength="6" required>
                </div>
                
                <div class="form-group">
                    <label for="signup-confirm">Confirm Password</label>
                    <input type="password" id="signup-confirm" minlength="6" required>
                </div>
                
                <button type="submit" class="auth-btn">Create Account</button>
            </form>
        </div>
    </div>
</div>

    <!-- Main Dashboard Content -->
    <div id="dashboard-content">
        <nav>
            <h1>Smart Waste Management</h1>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#request">Request Pickup</a></li>
            
                <li><a href="#about">About</a></li>
                <li><a href="#carbon-calculator">Carbon Calculator</a></li>
                <li><a href="#" id="logout-btn">Logout</a></li>
            </ul>
        </nav>

        <div class="main-content">
            <div class="container" id="home">
                <h2 class="heading">Welcome to Smart Waste Management</h2>
                <div class="info-section">
                    <p>This platform helps users request waste pickup, find recycling centers nearby, and track their past requests. Our mission is to create cleaner communities by promoting efficient waste handling and recycling.</p>
                </div>
            </div>

            <div class="container" id="request">
                <div class="card transform hover:scale-105 transition duration-300">
                    <h3>Request a Waste Pickup</h3>
                </div>
                <form action="/wastepickup/create" method="post" id="pickupForm">
                    <label>Waste Type:</label>
                    <select name="wasteType" id="wasteType">
                        <option value="Plastic">Plastic</option>
                        <option value="Electronic">Electronic</option>
                        <option value="Organic">Organic</option>
                        <option value="Hazardous">Hazardous</option>
                    </select>

                    <label>Pickup Location:</label>
                    <input type="text" name="pickupLocation" id="pickupLocation" required>

                    <button type="button" onclick="findCenters()">üîç Find Nearby Centers</button>

                    <div id="centerResults" style="margin-top: 10px;"></div>

                    <label>Pickup Date & Time:</label>
                    <input type="datetime-local" name="pickupDateTime" required>

                    <label>Status:</label>
                    <select name="status">
                        <option value="Pending">Pending</option>
                        <option value="Scheduled">Scheduled</option>
                        <option value="Completed">Completed</option>
                    </select>

                    <label>User Name:</label>
                    <input type="text" name="userName" id="user-name-field" required>

                    <button type="submit">üöõ Request Pickup</button>
                </form>
            </div>

            <div class="container">
                <h2>All Waste Pickup Requests</h2>
                <table>
                    <tr>
                        <th>Waste Type</th>
                        <th>Pickup Location</th>
                        <th>Pickup Date & Time</th>
                        <th>Status</th>
                        <th>User Name</th>
                        <th>Actions</th>
                    </tr>
                    <tr th:each="wastePickup : ${wastePickups}">
                        <td th:text="${wastePickup.wasteType}"></td>
                        <td th:text="${wastePickup.pickupLocation}"></td>
                        <td th:text="${wastePickup.pickupDateTime}"></td>
                        <td th:text="${wastePickup.status}"></td>
                        <td th:text="${wastePickup.userName}"></td>
                        <td>
                            <a th:href="@{'/wastepickup/edit/' + ${wastePickup.id}}">Edit</a> |
                            <a th:href="@{'/wastepickup/delete/' + ${wastePickup.id}}" onclick="return confirm('Are you sure?')">Delete</a>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="container" id="rewards">
                <h2>üéâ Your Rewards & Environmental Impact</h2>
                <div class="info-section">
                    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
                        <div style="flex: 1; min-width: 280px;">
                            <h3>üí∞ Your Account Balance: <span id="userMoney">‚Çπ0</span></h3>
                            
                            <h3 style="margin-top: 15px;">üå± Waste Management Points</h3>
                            <ul style="margin-top: 10px; list-style: square; padding-left: 20px; color: #2c3e50;">
                                <li><strong id="greenPoints">0 Green Points</strong> earned from waste pickups</li>
                                <li><strong id="ecoTokens">0 Eco Tokens</strong> for E-Waste pickups</li>
                                <li><strong id="bonusStars">0 Bonus Stars</strong> for consistent scheduling</li>
                            </ul>
                            <p style="margin-top: 15px;">Keep recycling and reach <strong>50 points</strong> to unlock discount coupons and special recognition badges!</p>
                        </div>
                        
                        <div style="flex: 1; min-width: 280px; border-left: 1px solid #eee; padding-left: 20px;">
                            <h3>üåé Your Carbon Impact</h3>
                            <div style="margin-top: 15px; background-color: #f0f8ff; border-radius: 8px; padding: 15px;">
                                <p style="font-size: 16px;">Total CO‚ÇÇ Savings: <strong style="color: #27ae60; font-size: 20px;"><span id="carbonSavedAmount">0.00</span> kg</strong></p>
                                <div id="carbon-impact-visual" style="margin-top: 10px; height: 20px; background-color: #eee; border-radius: 10px; overflow: hidden;">
                                    <div id="carbon-impact-progress" style="height: 100%; width: 0%; background-color: #27ae60; transition: width 1s ease-in-out;"></div>
                                </div>
                                <p style="margin-top: 8px; font-size: 14px;">Goal: 100 kg CO‚ÇÇ saved</p>
                            </div>
                            <p style="margin-top: 15px;">Every kg of CO‚ÇÇ you save helps combat climate change. <a href="#carbon-calculator" style="color: #1e3c72;">Calculate your impact now!</a></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container" id="carbon-calculator">
                <h2 class="heading">Carbon Emission Calculator</h2>
                <div class="info-section">
                    <p>Calculate the carbon footprint of your waste and see how much CO‚ÇÇ you're saving through proper waste management.</p>
                    
                    <form id="carbon-calculator-form">
                        <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 20px;">
                            <div style="flex: 1; min-width: 250px;">
                                <label for="waste-type-calc">Waste Type:</label>
                                <select id="waste-type-calc" name="wasteType">
                                    <option value="plastic">Plastic</option>
                                    <option value="paper">Paper</option>
                                    <option value="organic">Organic</option>
                                    <option value="electronic">Electronic</option>
                                    <option value="metal">Metal</option>
                                    <option value="glass">Glass</option>
                                </select>
            
                                <label for="waste-weight">Weight (kg):</label>
                                <input type="number" id="waste-weight" min="0.1" step="0.1" value="1" required>
                                
                                <label for="disposal-method">Disposal Method:</label>
                                <select id="disposal-method">
                                    <option value="landfill">Landfill</option>
                                    <option value="recycling">Recycling</option>
                                    <option value="composting">Composting</option>
                                    <option value="incineration">Incineration</option>
                                </select>
                                
                                <label for="transportation-distance">Transportation Distance (km):</label>
                                <input type="number" id="transportation-distance" min="0" step="0.1" value="5" required>
                            </div>
                            
                            <div style="flex: 1; min-width: 250px;">
                                <div id="calculation-results" style="background-color: #f0f8ff; padding: 15px; border-radius: 8px; margin-top: 32px;">
                                    <h3>Estimated Carbon Impact</h3>
                                    <div id="results-content">
                                        <p>Enter waste details and click Calculate to see results.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" onclick="calculateCarbon()" style="margin-top: 20px;">Calculate Carbon Impact</button>
                    </form>
                    
                    <div id="carbon-history" style="margin-top: 30px;">
                        <h3>Your Carbon Savings History</h3>
                        <div id="carbon-history-content">
                            <p>No calculations yet. Start calculating to track your carbon savings!</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container" id="about">
                <h2>About Us</h2>
                <div class="info-section">
                    <p>We are a tech-driven team committed to simplifying waste collection and making recycling easier. This website is designed to reduce pollution and connect users with appropriate recycling facilities across cities.</p>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>&copy; 2025 Smart Waste Management | All Rights Reserved</p>
        </div>
    </div>

    <script>
        // Authentication System
        // DOM elements
         // Authentication System
    // DOM elements
    const authOverlay = document.getElementById('auth-overlay');
    const authClose = document.getElementById('auth-close');
    const loginTab = document.getElementById('login-tab');
    const signupTab = document.getElementById('signup-tab');
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const dashboardContent = document.getElementById('dashboard-content');
    const logoutBtn = document.getElementById('logout-btn');
    const userNameField = document.getElementById('user-name-field');
    
    // Properly initialize the users array from localStorage
    function getUsersFromStorage() {
        try {
            const usersData = localStorage.getItem('users');
            return usersData ? JSON.parse(usersData) : [];
        } catch (error) {
            console.error("Error reading users from localStorage:", error);
            return [];
        }
    }
    
    // Check for logged in user
    function checkLoginStatus() {
        const currentUser = localStorage.getItem('currentUser');
        if (currentUser) {
            // Hide auth, show dashboard
            authOverlay.style.display = 'none';
            dashboardContent.style.display = 'block';
            
            // Update username field with the current user's name
            const userData = JSON.parse(currentUser);
            if (userNameField) {
                userNameField.value = userData.fullname;
            }
            
            // Update rewards and carbon data if available
            updateRewards();
            updateTotalCarbonSavings();
            updateCarbonVisual();
        } else {
            // Show auth, hide dashboard
            authOverlay.style.display = 'flex';
            dashboardContent.style.display = 'none';
        }
    }
    
    // Initialize the page
    checkLoginStatus();
    
    // Tab switching
    loginTab.addEventListener('click', function() {
        loginTab.classList.add('active');
        signupTab.classList.remove('active');
        loginForm.classList.add('active');
        signupForm.classList.remove('active');
    });
    
    signupTab.addEventListener('click', function() {
        signupTab.classList.add('active');
        loginTab.classList.remove('active');
        signupForm.classList.add('active');
        loginForm.classList.remove('active');
    });
    
    // Close authentication (only for demo, real app would require login)
    authClose.addEventListener('click', function() {
        if (confirm('Demo mode: Close login screen without authentication?')) {
            authOverlay.style.display = 'none';
            dashboardContent.style.display = 'block';
        }
    });
    
    // Handle signup form submission - FIXED
    document.getElementById('signup').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const fullname = document.getElementById('signup-name').value.trim();
        const email = document.getElementById('signup-email').value.trim();
        const password = document.getElementById('signup-password').value;
        const confirmPassword = document.getElementById('signup-confirm').value;
        
        // Validation
        if (!fullname) {
            alert('Please enter your full name');
            return;
        }
        
        if (!email) {
            alert('Please enter your email address');
            return;
        }
        
        // Simple email validation
        if (!email.includes('@') || !email.includes('.')) {
            alert('Please enter a valid email address');
            return;
        }
        
        if (password.length < 6) {
            alert('Password must be at least 6 characters long');
            return;
        }
        
        if (password !== confirmPassword) {
            alert('Passwords do not match!');
            return;
        }
        
        // Get current users from storage
        const users = getUsersFromStorage();
        
        // Check if user already exists
        if (users.some(user => user.email === email)) {
            alert('Email already registered. Please log in.');
            loginTab.click();
            return;
        }
        
        // Add user to database
        const newUser = { 
            fullname, 
            email, 
            password,
            points: 0,
            carbonSaved: 0
        };
        
        users.push(newUser);
        
        // Save to localStorage
        try {
            localStorage.setItem('users', JSON.stringify(users));
            
            // Clear form
            document.getElementById('signup').reset();
            
            // Auto-login the new user
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            
            // Update UI
            checkLoginStatus();
            
            // Show success message
            alert(`Account created successfully! Welcome, ${fullname}!`);
        } catch (error) {
            console.error("Error saving user data:", error);
            alert("There was an error creating your account. Please try again.");
        }
    });
    
    // Handle login form submission - FIXED
    document.getElementById('login').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        
        // Get users from storage
        const users = getUsersFromStorage();
        
        // Find user
        const user = users.find(u => u.email === email && u.password === password);
        
        if (user) {
            // Store logged in user
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            // Clear form
            document.getElementById('login').reset();
            
            // Update UI
            checkLoginStatus();
        } else {
            alert('Invalid email or password.');
        }
    });
    
    // Handle logout
    logoutBtn.addEventListener('click', function(e) {
        e.preventDefault();
        localStorage.removeItem('currentUser');
        checkLoginStatus();
    });
    
    // Waste Management System Functions
    // Example data for rewards
    let userData = {
        organicWaste: 5, 
        eWaste: 10, 
        consistentScheduling: 2, 
        totalPoints: 17,
        carbonSaved: 0
    };
    
    // Function to update rewards dynamically
    function updateRewards() {
        // Try to get user data from localStorage
        try {
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                const user = JSON.parse(currentUser);
                if (user.carbonSaved) {
                    userData.carbonSaved = user.carbonSaved;
                }
            }
        } catch (error) {
            console.error("Error updating rewards:", error);
        }
        
        // Update DOM elements
        if (document.getElementById('greenPoints')) {
            document.getElementById('greenPoints').textContent = `${userData.organicWaste} Green Points`;
        }
        if (document.getElementById('ecoTokens')) {
            document.getElementById('ecoTokens').textContent = `${userData.eWaste} Eco Tokens`;
        }
        if (document.getElementById('bonusStars')) {
            document.getElementById('bonusStars').textContent = `${userData.consistentScheduling} Bonus Stars`;
        }
        if (document.getElementById('carbonSavedAmount')) {
            document.getElementById('carbonSavedAmount').textContent = userData.carbonSaved.toFixed(2);
        }
    }
    
    // Keep the rest of your functions as they are...
    
   // Modify the findCenters function to simulate location search
function findCenters() {
    const location = document.getElementById('pickupLocation').value.trim();
    const wasteType = document.getElementById('wasteType').value;

    if (location === "") {
        alert("Please enter a pickup location.");
        return;
    }

    // Display spinning loader while "searching"
    document.getElementById("centerResults").innerHTML = `
        <div style="margin-top: 10px;">
            <span style="display: inline-block; animation: spin 1s linear infinite;">üîç</span> Searching for ${wasteType} waste centers...
        </div>
    `;

    // Simulate API call with setTimeout
    setTimeout(() => {
        // Sample locations based on waste type
        let nearbyPlaces = [];
        switch (wasteType) {
            case "Organic":
                nearbyPlaces = [
                    "Green Earth Composting Center",
                    "City Farmers Collective",
                    "OrganicWaste Solutions Ltd"
                ];
                break;
            case "Plastic":
                nearbyPlaces = [
                    "EcoPlastic Recycling Center",
                    "PET Bottle Collection Hub",
                    "Sustainable Plastics Inc."
                ];
                break;
            case "Electronic":
                nearbyPlaces = [
                    "E-Cycle Solutions",
                    "TechWaste Recyclers",
                    "Electronics Disposal Center"
                ];
                break;
            case "Hazardous":
                nearbyPlaces = [
                    "SafeDisposal Hazardous Waste Facility",
                    "ChemSafe Disposal Center",
                    "Municipal Hazardous Waste Depot"
                ];
                break;
            default:
                nearbyPlaces = [
                    "General Recycling Center",
                    "Community Waste Management",
                    "City Disposal Facility"
                ];
        }

        // Create the results display
        let resultsHTML = `
            <div style="margin-top: 15px; padding: 10px; background-color: #f5f5f5; border-radius: 8px;">
                <h4 style="margin-bottom: 8px;">Nearby ${wasteType} Waste Centers:</h4>
                <ul style="list-style-type: none; padding: 0;">`;
        
        // Add each location with click handler
        nearbyPlaces.forEach((place, index) => {
            resultsHTML += `
                <li style="padding: 8px; margin-bottom: 5px; background-color: white; border-radius: 4px; cursor: pointer; transition: all 0.2s ease;"
                    onmouseover="this.style.backgroundColor='#e9f7fe'" 
                    onmouseout="this.style.backgroundColor='white'"
                    onclick="selectLocation('${place}')">
                    ${index + 1}. ${place} <span style="float: right; color: #1e3c72;">Select</span>
                </li>`;
        });
        
        resultsHTML += `
                </ul>
                <div style="margin-top: 10px; font-size: 12px; text-align: right;">
                    <a href="https://www.google.com/maps/search/${encodeURIComponent(wasteType + ' waste centers near ' + location)}" 
                       target="_blank" style="color: #1e3c72;">
                       View more on Google Maps
                    </a>
                </div>
            </div>`;
            
        document.getElementById("centerResults").innerHTML = resultsHTML;
    }, 1500); // Simulate 1.5 second search delay
}

// Function to select a location and update the pickup location field
function selectLocation(locationName) {
    document.getElementById('pickupLocation').value = locationName;
    
    // Add visual feedback
    const pickupLocationField = document.getElementById('pickupLocation');
    pickupLocationField.style.backgroundColor = '#e9f7fe';
    pickupLocationField.style.borderColor = '#1e3c72';
    
    // Clear the highlight after a moment
    setTimeout(() => {
        pickupLocationField.style.backgroundColor = '';
        pickupLocationField.style.borderColor = '';
    }, 1500);
    
    // Clear the results section with a fade effect
    const centerResults = document.getElementById('centerResults');
    centerResults.style.transition = 'opacity 0.5s ease';
    centerResults.style.opacity = '0.5';
    
    // Show success message
    setTimeout(() => {
        centerResults.innerHTML = `
            <div style="margin-top: 10px; color: #27ae60; font-weight: bold;">
                ‚úì "${locationName}" selected as pickup location
            </div>`;
        centerResults.style.opacity = '1';
        
        // Clear the message after a few seconds
        setTimeout(() => {
            centerResults.style.opacity = '0';
            setTimeout(() => {
                centerResults.innerHTML = '';
                centerResults.style.opacity = '1';
            }, 500);
        }, 3000);
    }, 500);
}

// Add this to your existing JavaScript code
// Add this to your existing event listeners in the DOMContentLoaded section
    
    // Include the rest of your carbon calculator functions as they were...
    
    // Make sure to call these functions when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        displayCarbonHistory();
        updateTotalCarbonSavings();
        updateCarbonVisual();
    });
    // Add this JavaScript code right after the existing script section

// Constants for waste type rewards
const WASTE_TYPE_REWARDS = {
    'Plastic': { points: 5, money: 7 },
    'Electronic': { points: 10, money: 12 },
    'Organic': { points: 3, money: 5 },
    'Hazardous': { points: 15, money: 20 }
};

// Store for waste pickup requests
let wastePickups = [];

// Function to parse date/time from input
function parsePickupDateTime(dateTimeStr) {
    return new Date(dateTimeStr);
}

// Function to add a new waste pickup request
function addWastePickup(wasteType, location, dateTime, userName) {
    const id = Date.now(); // Simple ID generation
    const newPickup = {
        id,
        wasteType,
        pickupLocation: location,
        pickupDateTime: dateTime,
        status: 'Pending',
        userName
    };
    
    wastePickups.push(newPickup);
    
    // Save to localStorage
    saveWastePickups();
    
    // Schedule status updates
    scheduleStatusUpdates(newPickup);
    
    return newPickup;
}

// Save waste pickups to localStorage
function saveWastePickups() {
    localStorage.setItem('wastePickups', JSON.stringify(wastePickups));
}

// Load waste pickups from localStorage
function loadWastePickups() {
    try {
        const stored = localStorage.getItem('wastePickups');
        if (stored) {
            wastePickups = JSON.parse(stored);
            
            // Convert stored date strings back to Date objects
            wastePickups.forEach(pickup => {
                pickup.pickupDateTime = new Date(pickup.pickupDateTime);
            });
            
            // Schedule status updates for all loaded pickups
            wastePickups.forEach(pickup => {
                if (pickup.status !== 'Completed') {
                    scheduleStatusUpdates(pickup);
                }
            });
        }
    } catch (error) {
        console.error("Error loading waste pickups:", error);
    }
}

// Schedule status updates based on pickup time
function scheduleStatusUpdates(pickup) {
    const pickupTime = new Date(pickup.pickupDateTime);
    const now = new Date();
    
    // Calculate times for status changes
    const scheduledTime = new Date(pickupTime);
    scheduledTime.setSeconds(scheduledTime.getSeconds() - 30); // 30 seconds before pickup
    
    // For testing/demo purposes - schedule updates if pickup time is in the future
    if (pickupTime > now) {
        // Schedule 'Scheduled' status update
        if (scheduledTime > now) {
            const msUntilScheduled = scheduledTime - now;
            setTimeout(() => {
                updatePickupStatus(pickup.id, 'Scheduled');
                refreshPickupTable();
            }, msUntilScheduled);
        }
        
        // Schedule 'Completed' status update
        const msUntilCompleted = pickupTime - now;
        setTimeout(() => {
            updatePickupStatus(pickup.id, 'Completed');
            addRewardsForCompletion(pickup);
            refreshPickupTable();
            updateRewards();
        }, msUntilCompleted);
    } 
    // If pickup time is in the past, update status immediately if needed
    else if (pickup.status !== 'Completed') {
        updatePickupStatus(pickup.id, 'Completed');
        addRewardsForCompletion(pickup);
        refreshPickupTable();
        updateRewards();
    }
}

// Update pickup status
function updatePickupStatus(pickupId, newStatus) {
    const pickup = wastePickups.find(p => p.id === pickupId);
    if (pickup) {
        pickup.status = newStatus;
        saveWastePickups();
        
        // If status changed to completed, add rewards
        if (newStatus === 'Completed') {
            addRewardsForCompletion(pickup);
        }
    }
}

// Add rewards when a pickup is completed
function addRewardsForCompletion(pickup) {
    try {
        const currentUserStr = localStorage.getItem('currentUser');
        if (!currentUserStr) return;
        
        const currentUser = JSON.parse(currentUserStr);
        const wasteType = pickup.wasteType;
        
        // Get reward amounts based on waste type
        const rewards = WASTE_TYPE_REWARDS[wasteType] || { points: 1, money: 2 };
        
        // Update user's points and money
        if (!currentUser.points) currentUser.points = 0;
        if (!currentUser.money) currentUser.money = 0;
        if (!currentUser.carbonSaved) currentUser.carbonSaved = 0;
        
        currentUser.points += rewards.points;
        currentUser.money += rewards.money;
        
        // Calculate and add carbon savings
        let carbonSaved = 0;
        switch (wasteType) {
            case 'Plastic':
                carbonSaved = 2.5; // kg of CO2
                break;
            case 'Electronic':
                carbonSaved = 4.0;
                break;
            case 'Organic':
                carbonSaved = 1.8;
                break;
            case 'Hazardous':
                carbonSaved = 3.2;
                break;
            default:
                carbonSaved = 1.0;
        }
        
        currentUser.carbonSaved += carbonSaved;
        
        // Update localStorage
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        // Update users array
        const users = getUsersFromStorage();
        const userIndex = users.findIndex(u => u.email === currentUser.email);
        if (userIndex >= 0) {
            users[userIndex] = currentUser;
            localStorage.setItem('users', JSON.stringify(users));
        }
        
        // Show notification
        const notification = document.createElement('div');
        notification.style.position = 'fixed';
        notification.style.bottom = '20px';
        notification.style.right = '20px';
        notification.style.backgroundColor = '#4CAF50';
        notification.style.color = 'white';
        notification.style.padding = '15px';
        notification.style.borderRadius = '5px';
        notification.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        notification.style.zIndex = '1000';
        notification.innerHTML = `
            <h3>üéâ Pickup Completed!</h3>
            <p>You earned:</p>
            <ul>
                <li>+${rewards.points} points</li>
                <li>+‚Çπ${rewards.money} added to your account</li>
                <li>+${carbonSaved.toFixed(1)} kg CO‚ÇÇ saved</li>
            </ul>
        `;
        
        document.body.appendChild(notification);
        
        // Remove notification after 5 seconds
        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transition = 'opacity 1s';
            setTimeout(() => notification.remove(), 1000);
        }, 5000);
        
    } catch (error) {
        console.error("Error adding rewards:", error);
    }
}

// Update the rewards display
function updateRewards() {
    try {
        const currentUserStr = localStorage.getItem('currentUser');
        if (!currentUserStr) return;
        
        const user = JSON.parse(currentUserStr);
        
        // Update points displays
        if (document.getElementById('greenPoints')) {
            document.getElementById('greenPoints').textContent = `${user.points || 0} Green Points`;
        }
        
        // Display the user's money
        if (document.getElementById('userMoney')) {
            document.getElementById('userMoney').textContent = `‚Çπ${user.money || 0}`;
        } else {
            // Create money display if it doesn't exist
            const rewardsSection = document.getElementById('rewards');
            if (rewardsSection) {
                const moneyElement = document.createElement('div');
                moneyElement.innerHTML = `<h3>üí∞ Your Account Balance: <span id="userMoney">‚Çπ${user.money || 0}</span></h3>`;
                rewardsSection.querySelector('.info-section').prepend(moneyElement);
            }
        }
        
        // Update carbon impact
        if (document.getElementById('carbonSavedAmount')) {
            document.getElementById('carbonSavedAmount').textContent = (user.carbonSaved || 0).toFixed(2);
        }
        
        // Update carbon visual
        updateCarbonVisual();
    } catch (error) {
        console.error("Error updating rewards display:", error);
    }
}

// Update the carbon impact visual indicator
function updateCarbonVisual() {
    try {
        const currentUserStr = localStorage.getItem('currentUser');
        if (!currentUserStr) return;
        
        const user = JSON.parse(currentUserStr);
        const carbonSaved = user.carbonSaved || 0;
        
        // Goal is 100kg CO2
        const percentComplete = Math.min(carbonSaved / 100 * 100, 100);
        
        const progressBar = document.getElementById('carbon-impact-progress');
        if (progressBar) {
            progressBar.style.width = `${percentComplete}%`;
        }
    } catch (error) {
        console.error("Error updating carbon visual:", error);
    }
}

// Refresh the pickup requests table
function refreshPickupTable() {
    const table = document.querySelector('table');
    if (!table) return;
    
    // Keep the header row
    const headerRow = table.rows[0];
    table.innerHTML = '';
    table.appendChild(headerRow);
    
    // Add all pickup requests
    wastePickups.forEach(pickup => {
        const row = table.insertRow();
        
        // Format date for display
        const pickupDate = new Date(pickup.pickupDateTime);
        const formattedDate = pickupDate.toLocaleString();
        
        // Add cells
        const cellWasteType = row.insertCell();
        cellWasteType.textContent = pickup.wasteType;
        
        const cellLocation = row.insertCell();
        cellLocation.textContent = pickup.pickupLocation;
        
        const cellDateTime = row.insertCell();
        cellDateTime.textContent = formattedDate;
        
        const cellStatus = row.insertCell();
        cellStatus.textContent = pickup.status;
        
        // Highlight status based on type
        if (pickup.status === 'Completed') {
            cellStatus.style.color = 'green';
            cellStatus.style.fontWeight = 'bold';
        } else if (pickup.status === 'Scheduled') {
            cellStatus.style.color = 'orange';
        }
        
        const cellUserName = row.insertCell();
        cellUserName.textContent = pickup.userName;
        
        const cellActions = row.insertCell();
        cellActions.innerHTML = `
            <a href="#" onclick="editPickup(${pickup.id})">Edit</a> |
            <a href="#" onclick="deletePickup(${pickup.id})">Delete</a>
        `;
    });
}

// Edit a pickup
function editPickup(id) {
    const pickup = wastePickups.find(p => p.id === id);
    if (!pickup) return;
    
    // Here you could display a form with the pickup data
    alert("Edit functionality would be implemented here");
}

// Delete a pickup
function deletePickup(id) {
    if (confirm("Are you sure you want to delete this pickup request?")) {
        wastePickups = wastePickups.filter(p => p.id !== id);
        saveWastePickups();
        refreshPickupTable();
    }
}

// Initialize carbon calculator functions
function calculateCarbon() {
    const wasteType = document.getElementById('waste-type-calc').value;
    const wasteWeight = parseFloat(document.getElementById('waste-weight').value);
    const disposalMethod = document.getElementById('disposal-method').value;
    const distance = parseFloat(document.getElementById('transportation-distance').value);
    
    if (isNaN(wasteWeight) || wasteWeight <= 0 || isNaN(distance) || distance < 0) {
        alert("Please enter valid weight and distance values");
        return;
    }
    
    // Approximate carbon factors for different waste types and disposal methods
    const carbonFactors = {
        plastic: { landfill: 2.5, recycling: 0.3, composting: 0, incineration: 1.8 },
        paper: { landfill: 1.5, recycling: 0.2, composting: 0.8, incineration: 1.0 },
        organic: { landfill: 1.8, recycling: 0, composting: 0.2, incineration: 0.9 },
        electronic: { landfill: 4.0, recycling: 0.5, composting: 0, incineration: 2.5 },
        metal: { landfill: 3.0, recycling: 0.4, composting: 0, incineration: 1.5 },
        glass: { landfill: 0.8, recycling: 0.1, composting: 0, incineration: 0.5 }
    };
    
    // Transportation carbon factor (kg CO2 per km per kg waste)
    const transportFactor = 0.01;
    
    // Calculate base emissions
    const baseEmission = carbonFactors[wasteType][disposalMethod] * wasteWeight;
    
    // Calculate transport emissions
    const transportEmission = transportFactor * distance * wasteWeight;
    
    // Total emissions
    const totalEmission = baseEmission + transportEmission;
    
    // Calculate savings (compared to landfill)
    const landfillEmission = carbonFactors[wasteType]['landfill'] * wasteWeight;
    const savings = disposalMethod !== 'landfill' ? landfillEmission - baseEmission : 0;
    
    // Display results
    const resultsContent = document.getElementById('results-content');
    resultsContent.innerHTML = `
        <div style="font-size: 16px; margin-bottom: 15px;">
            <p style="margin-bottom: 10px;">For ${wasteWeight} kg of ${wasteType} waste using ${disposalMethod}:</p>
            <table style="width: 100%; border-collapse: collapse;">
                <tr>
                    <td>CO‚ÇÇ Emissions:</td>
                    <td style="text-align: right; font-weight: bold;">${totalEmission.toFixed(2)} kg</td>
                </tr>
                <tr>
                    <td>CO‚ÇÇ Savings vs Landfill:</td>
                    <td style="text-align: right; font-weight: bold; color: ${savings > 0 ? 'green' : 'inherit'}">
                        ${savings.toFixed(2)} kg
                    </td>
                </tr>
            </table>
        </div>
        <button type="button" onclick="saveCalculation(${savings.toFixed(2)})" 
            style="background-color: #27ae60; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">
            Save to History
        </button>
    `;
}

// Save calculation to history
function saveCalculation(carbonSaved) {
    try {
        // Get current user
        const currentUserStr = localStorage.getItem('currentUser');
        if (!currentUserStr) {
            alert("Please log in to save your calculations");
            return;
        }
        
        const currentUser = JSON.parse(currentUserStr);
        
        // Add to carbon saved
        if (!currentUser.carbonSaved) currentUser.carbonSaved = 0;
        currentUser.carbonSaved += parseFloat(carbonSaved);
        
        // Save back to localStorage
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        // Update users array
        const users = getUsersFromStorage();
        const userIndex = users.findIndex(u => u.email === currentUser.email);
        if (userIndex >= 0) {
            users[userIndex] = currentUser;
            localStorage.setItem('users', JSON.stringify(users));
        }
        
        // Add to carbon history
        if (!currentUser.carbonHistory) currentUser.carbonHistory = [];
        
        const newHistory = {
            date: new Date().toLocaleDateString(),
            saved: parseFloat(carbonSaved),
            type: document.getElementById('waste-type-calc').value,
            weight: parseFloat(document.getElementById('waste-weight').value),
            method: document.getElementById('disposal-method').value
        };
        
        currentUser.carbonHistory.push(newHistory);
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        
        // Update display
        displayCarbonHistory();
        updateTotalCarbonSavings();
        updateCarbonVisual();
        
        alert(`Calculation saved! You've saved ${carbonSaved} kg of CO‚ÇÇ`);
    } catch (error) {
        console.error("Error saving calculation:", error);
    }
}

// Display carbon history
function displayCarbonHistory() {
    try {
        const currentUserStr = localStorage.getItem('currentUser');
        if (!currentUserStr) return;
        
        const user = JSON.parse(currentUserStr);
        const history = user.carbonHistory || [];
        
        const historyContent = document.getElementById('carbon-history-content');
        if (!historyContent) return;
        
        if (history.length === 0) {
            historyContent.innerHTML = "<p>No calculations yet. Start calculating to track your carbon savings!</p>";
            return;
        }
        
        let html = `<table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
            <tr style="background-color: #f5f5f5;">
                <th style="padding: 8px; text-align: left;">Date</th>
                <th style="padding: 8px; text-align: left;">Type</th>
                <th style="padding: 8px; text-align: left;">Method</th>
                <th style="padding: 8px; text-align: right;">Weight (kg)</th>
                <th style="padding: 8px; text-align: right;">CO‚ÇÇ Saved (kg)</th>
            </tr>`;
        
        history.forEach(item => {
            html += `<tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 8px;">${item.date}</td>
                <td style="padding: 8px;">${item.type}</td>
                <td style="padding: 8px;">${item.method}</td>
                <td style="padding: 8px; text-align: right;">${item.weight}</td>
                <td style="padding: 8px; text-align: right; color: green;">${item.saved.toFixed(2)}</td>
            </tr>`;
        });
        
        html += `</table>`;
        historyContent.innerHTML = html;
    } catch (error) {
        console.error("Error displaying carbon history:", error);
    }
}

// Update total carbon savings
function updateTotalCarbonSavings() {
    try {
        const currentUserStr = localStorage.getItem('currentUser');
        if (!currentUserStr) return;
        
        const user = JSON.parse(currentUserStr);
        const carbonSaved = user.carbonSaved || 0;
        
        if (document.getElementById('carbonSavedAmount')) {
            document.getElementById('carbonSavedAmount').textContent = carbonSaved.toFixed(2);
        }
    } catch (error) {
        console.error("Error updating carbon savings:", error);
    }
}

// Modify the submission handler of the pickup form
document.getElementById('pickupForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const wasteType = document.getElementById('wasteType').value;
    const location = document.getElementById('pickupLocation').value;
    const dateTimeInput = this.querySelector('input[name="pickupDateTime"]').value;
    const userName = document.getElementById('user-name-field').value;
    
    if (!location || !dateTimeInput || !userName) {
        alert('Please fill in all required fields.');
        return;
    }
    
    // Create new pickup
    const pickupDateTime = new Date(dateTimeInput);
    const newPickup = addWastePickup(wasteType, location, pickupDateTime, userName);
    
    // Refresh the table
    refreshPickupTable();
    
    // Clear form
    this.reset();
    if (document.getElementById('user-name-field')) {
        // Keep username filled
        const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        document.getElementById('user-name-field').value = currentUser.fullname || '';
    }
    
    alert('Waste pickup request submitted successfully!');
});

// Load waste pickups on page load
document.addEventListener('DOMContentLoaded', function() {
    loadWastePickups();
    refreshPickupTable();
    displayCarbonHistory();
    updateTotalCarbonSavings();
    updateCarbonVisual();
    updateRewards();
});
</script>
</body>
</html>